/*
 * WARNING
 *
 * To create an SVG diagram from this file, install graphviz and run:
 *   dot -Tsvg "$1.dot" -o "$1.svg"   (on a Linux   machine)
 *   dot -Tsvg "%1.dot" -o "%1.svg"   (on a Windows machine)
 */


digraph GradleSetup {
  label="Gradle Build Setup"
  labelloc=t
  labeljust=l

  subgraph cluster1 {
    label="Java Projects / Bnd Projects";
    labelloc=b
    labeljust=l
    style=filled;
    fillcolor=lightgrey;
    color=black;

    subgraph cluster101 {
      label="";
      style=invis;
      compileJava          [shape=box, style=filled, fillcolor=lightcyan, label="compileJava"         ]
      processResources     [shape=box, style=filled, fillcolor=lightcyan, label="processResources"    ]
      classes              [shape=box, style=filled, fillcolor=lightcyan, label="classes"             ]
    }

    subgraph cluster102 {
      label="";
      style=invis;
      jar                  [shape=box, style=filled, fillcolor=lightcyan, label="jar"                 ]
      bundle               [shape=box, style=filled, fillcolor=cyan     , label="bundle"              ]
    }

    subgraph cluster103 {
      label="";
      style=invis;
      compileTestJava      [shape=box, style=filled, fillcolor=lightcyan, label="compileTestJava"     ]
      processTestResources [shape=box, style=filled, fillcolor=lightcyan, label="processTestResources"]
      testClasses          [shape=box, style=filled, fillcolor=lightcyan, label="testClasses"         ]
    }

    subgraph cluster104 {
      label="";
      style=invis;
      test                 [shape=box, style=filled, fillcolor=lightcyan, label="test"                ]
    }

    subgraph cluster105 {
      label="";
      style=invis;
      uploadArchives       [shape=box, style=filled, fillcolor=lightcyan, label="uploadArchives"      ]
      assemble             [shape=box, style=filled, fillcolor=lightcyan, label="assemble"            ]
    }

    subgraph cluster106 {
      label="";
      style=invis;
      check                [shape=box, style=filled, fillcolor=cyan     , label="check"               ]
      checkNeeded          [shape=box, style=filled, fillcolor=cyan     , label="checkNeeded"         ]
    }

    subgraph cluster107 {
      label="";
      style=invis;
      release              [shape=box, style=filled, fillcolor=cyan     , label="release"             ]
      releaseNeeded        [shape=box, style=filled, fillcolor=cyan     , label="releaseNeeded"       ]
    }

    subgraph cluster108 {
      label="";
      style=invis;
      exportX              [shape=box3d, style=filled, fillcolor=cyan   , label="export.<name>"       ]
      export               [shape=box  , style=filled, fillcolor=cyan   , label="export"              ]
    }

    subgraph cluster109 {
      label="";
      style=invis;
      build                [shape=box, style=filled, fillcolor=lightcyan, label="build"               ]
      buildDependents      [shape=box, style=filled, fillcolor=lightcyan, label="buildDependents"     ]
      buildNeeded          [shape=box, style=filled, fillcolor=lightcyan, label="buildNeeded"         ]
    }

    subgraph cluster110 {
      label="";
      style=invis;
    }

    javadoc                [shape=box, style=filled, fillcolor=lightcyan, label="javadoc"             ]

    clean                  [shape=box, style=filled, fillcolor=cyan     , label="clean"               ]
    echo                   [shape=box, style=filled, fillcolor=cyan     , label="echo"                ]
    bndproperties          [shape=box, style=filled, fillcolor=cyan     , label="bndproperties"       ]
    jacocoTestReport       [shape=box, style=filled, fillcolor=orange   , label="jacocoTestReport"    ]
    findbugsMain           [shape=box, style=filled, fillcolor=orange   , label="findbugsMain"        ]
    findbugsTest           [shape=box, style=filled, fillcolor=orange   , label="findbugsTest"        ]

    compileJava            -> classes
    processResources       -> classes
    classes                -> javadoc
    classes                -> compileTestJava
    classes                -> jar
    classes                -> test
    compileTestJava        -> testClasses
    processTestResources   -> testClasses
    jar                    -> uploadArchives
    jar                    -> assemble
    testClasses            -> test
    assemble               -> build
    assemble               -> check
    test                   -> check
    check                  -> checkNeeded
    checkNeeded            -> checkNeeded        [color=red   ]
    check                  -> build
    build                  -> buildDependents
    buildDependents        -> buildDependents    [color=yellow]
    build                  -> buildNeeded
    buildNeeded            -> buildNeeded        [color=red   ]

    classes                -> bundle
    bundle                 -> jar                [style=dashed]
    compileJava            -> compileJava        [color=red   ]
    assemble               -> release
    assemble               -> exportX
    exportX                -> export
    release                -> releaseNeeded
    releaseNeeded          -> releaseNeeded      [color=red   ]

    classes                -> findbugsMain
    testClasses            -> findbugsTest
    findbugsMain           -> check              [color=green ]
    findbugsTest           -> check              [color=green ]
    test                   -> jacocoTestReport
  }


  subgraph cluster2 {
    label="Root Project";
    labelloc=b
    labeljust=l
    style=filled;
    fillcolor=lightgrey;
    color=black;

    init                   [shape=box, style=filled, fillcolor=lightcyan, label="init"                ]
    wrapper                [shape=box, style=filled, fillcolor=orange   , label="wrapper"             ]
  }


  subgraph cluster3 {
    label="All Projects";
    labelloc=b
    labeljust=l
    style=filled;
    fillcolor=lightgrey;
    color=black;

    subgraph cluster301 {
      label="";
      style=invis;
      index                [shape=box, style=filled, fillcolor=orange   , label="index"               ]
    }

    subgraph cluster302 {
      label="";
      style=invis;
      cleanAll             [shape=box, style=filled, fillcolor=orange   , label="clean"               ]
      cleanAllNeeded       [shape=box, style=filled, fillcolor=orange   , label="cleanNeeded"         ]
      distclean            [shape=box, style=filled, fillcolor=orange   , label="distclean"           ]
      distcleanNeeded      [shape=box, style=filled, fillcolor=orange   , label="distcleanNeeded"     ]
    }

    clean                  -> cleanAll           [color=blue  ]
    cleanAll               -> cleanAllNeeded     [color=blue  ]
    cleanAllNeeded         -> cleanAllNeeded     [color=red   ]
    cleanAll               -> distclean          [color=blue  ]
    distclean              -> distcleanNeeded
    distcleanNeeded        -> distcleanNeeded    [color=red   ]
  }


  subgraph cluster4 {
    label="Build Project";
    labelloc=b
    labeljust=l
    style=filled;
    fillcolor=lightgrey;
    color=black;

    p2Entry                [shape=box, style=filled , fillcolor=none     , label="p2Entry"               ]

    p2FeaturesTree         [shape=box, style=filled, fillcolor=none      , label="p2FeaturesTree"        ]
    p2FeatureGradlePlugin  [shape=box, style=filled, fillcolor=none      , label="p2FeatureGradlePlugin" ]
    p2Features             [shape=box, style=filled, fillcolor=none      , label="p2Features"            ]

    p2PluginsPelagic       [shape=box, style=filled, fillcolor=none      , label="p2PluginsPelagic"      ]
    p2Plugins              [shape=box, style=filled, fillcolor=none      , label="p2Plugins"             ]

    p2                     [shape=box, style=filled, fillcolor=yellow    , label="p2"                    ]

    indexBuild             [shape=box, style=filled, fillcolor=yellow    , label="index"                 ]

    distCompositePelagic   [shape=box, style=filled, fillcolor=none      , label="distCompositePelagic"  ]
    distZipPelagic         [shape=box, style=filled, fillcolor=none      , label="distZipPelagic"        ]
    dist                   [shape=box, style=filled, fillcolor=yellow    , label="dist"                  ]

    jar                    -> p2Entry            [color=red   ]

    p2Entry                -> p2FeaturesTree
    p2FeaturesTree         -> p2FeatureGradlePlugin
    p2FeatureGradlePlugin  -> p2Features

    p2Entry                -> p2PluginsPelagic
    p2PluginsPelagic       -> p2Plugins

    p2Features             -> p2
    p2Plugins              -> p2

    p2                     -> indexBuild

    indexBuild             -> distCompositePelagic
    indexBuild             -> distZipPelagic
    distCompositePelagic   -> distZipPelagic
    distZipPelagic         -> dist
  }
}
